generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Room {
  id        String   @id @default(cuid())
  roomId    String   @unique // e.g. "101"
  createdAt DateTime @default(now())
  guests    Guest[]
}

model Guest {
  id                String             @id @default(cuid())
  firstName         String
  lastName          String
  roomId            String
  room              Room               @relation(fields: [roomId], references: [id])
  pushToken         String?
  backboardThreadId String? // one Backboard thread per stay (own memory context)
  checkedIn         Boolean            @default(false) // concierge only works when true
  checkedInAt       DateTime? // when check-in was pressed
  checkedOut        Boolean            @default(false) // when true, account disabled on concierge site
  checkedOutAt      DateTime? // when check-out was pressed (archived)
  archived          Boolean            @default(false) // when true, hidden from active rooms list (checked-out guests)
  archivedVia       String? // "check_out" | "manual"
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  requests          Request[]
  conciergeSessions ConciergeSession[]
}

model Request {
  id          String    @id @default(cuid())
  guestId     String
  guest       Guest     @relation(fields: [guestId], references: [id])
  roomId      String // room number "101" for dashboard
  type        String // "request" | "complaint"
  description String
  status      String? // "open" | "closed"; null = open for backwards compat
  closedAt    DateTime? // when manager closed the request
  createdAt   DateTime  @default(now())
}

model ConciergeSession {
  id        String   @id @default(cuid())
  guestId   String   @unique // one active session per guest for MVP
  guest     Guest    @relation(fields: [guestId], references: [id])
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Setting {
  id    String @id @default(cuid())
  key   String @unique
  value String // JSON or plain string
}
